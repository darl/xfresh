<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
        "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-autowire="byName">
    <!--Spring helpers-->
    <bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"/>

    <bean id="resourseBase" class="java.lang.String">
        <constructor-arg index="0" value="./web"/>
    </bean>

    <!--Jetty beans-->
    <bean id="serverInitializer" class="net.sf.xfresh.jetty.JettyServerInitializer">
        <property name="port" value="8080"/>
        <property name="maxThreads" value="10"/>
        <property name="handlers">
            <list>
                <bean class="net.sf.xfresh.server.UrlRewriteHandler">
                    <property name="handler">
                        <bean class="net.sf.xfresh.jetty.YaletXmlPageHandler">
                            <property name="resourceBase" ref="resourseBase"/>
                        </bean>
                    </property>
                    <property name="pathPatternToPage">
                        <map>
                            <entry key="/" value="/index.xml"/>
                        </map>
                    </property>
                </bean>
                <bean class="org.mortbay.jetty.handler.ResourceHandler">
                    <property name="resourceBase" ref="resourseBase"/>
                </bean>
            </list>
        </property>
    </bean>

    <!--Fresh core beans-->
    <bean id="yaletProcessor" class="net.sf.xfresh.core.YaletProcessor">
        <property name="encoding" value="utf-8"/>
    </bean>

    <bean id="yaletSupport" class="ru.darlz.ff.RemoteYaletSupport">
        <!--<bean id="yaletSupport" class="net.sf.xfresh.ext.ExtYaletSupport">-->
        <property name="resourceBase" value="./web"/>
        <property name="authHandler">
            <!--<bean class="net.sf.xfresh.ext.AlwaysNoAuthHandler"/>-->
            <bean class="net.sf.xfresh.ext.SimpleHttpAuthHandler">
                <property name="authUrl" value="http://localhost:33001/userInfo"/>
                <property name="userIdXpath" value="data/user-info/uid/text()"/>
            </bean>
        </property>

        <property name="serviceHost" value="localhost"/>
        <property name="thriftPort" value="33004"/>
        <property name="protobufPort" value="33005"/>
    </bean>

    <bean id="yaletResolver" class="net.sf.xfresh.core.SpringYaletResolver"/>

    <bean id="saxGenerator" class="net.sf.xfresh.core.DefaultSaxGenerator"/>

    <bean id="singleYaletProcessor" class="net.sf.xfresh.core.DefaultSingleYaletProcessor"/>

</beans>